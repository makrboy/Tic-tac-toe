<!DOCTYPE html>
<html>
<head>
    <title>Tic Tac Toe</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #222;
            color: #f2f2f2;
            text-align: center;
            padding-top: 3em;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            grid-template-rows: repeat(3, 60px);
            grid-gap: 5px;
            justify-content: center;
            margin: 0 auto;
        }

        .cell {
            width: 60px;
            height: 60px;
            background: #4CAF50;
            cursor: pointer;
            position: relative;
        }

        .cell.x:before, .cell.o:before {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
            width: 50px;
            height: 50px;
            background-repeat: no-repeat;
            background-position: center center;
            background-size: contain;
        }

        .cell.x:before {
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><line x1='0' y1='0' x2='40' y2='40' stroke='black' stroke-width='2'/><line x1='40' y1='0' x2='0' y2='40' stroke='black' stroke-width='2'/></svg>");
        }

        .cell.o:before {
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><circle cx='20' cy='20' r='15' stroke='black' stroke-width='2' fill='transparent'/></svg>");
        }

        @keyframes xToO {
            0% { background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><line x1='0' y1='0' x2='40' y2='40' stroke='black' stroke-width='2'/><line x1='40' y1='0' x2='0' y2='40' stroke='black' stroke-width='2'/></svg>"); }
            100% { background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><circle cx='20' cy='20' r='15' stroke='black' stroke-width='2' fill='transparent'/></svg>"); }
        }

        .cell.o.fromX {
            animation: xToO 0.5s forwards;
        }
    </style>
</head>
<body>
    <div id="turn">Your turn!</div>
    <div class="board" id="board">
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell"></div>
    </div>
    <div id="message" class="hidden">
        <div id="win-message"></div>
        <button id="restart">Restart</button>
    </div>
    <script>
        const cells = Array.from(document.querySelectorAll('.cell'));
        const turnDisplay = document.getElementById('turn');
        const message = document.getElementById('message');
        const winMessage = document.getElementById('win-message');
        const restartButton = document.getElementById('restart');
        let board = [['', '', ''], ['', '', ''], ['', '', '']];
        let turn = 0;
        let changing = false;

        function checkWin(board, player) {
            for (let i = 0; i < 3; i++) {
                if (board[i][0] === player && board[i][1] === player && board[i][2] === player) return true;
                if (board[0][i] === player && board[1][i] === player && board[2][i] === player) return true;
            }

            if (board[0][0] === player && board[1][1] === player && board[2][2] === player) return true;
            if (board[2][0] === player && board[1][1] === player && board[0][2] === player) return true;
            return false;
        }

        function checkTie(board) {
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (board[i][j] === '') return false;
                }
            }
            return true;
        }

        function minimax(board, depth, isMax) {
            if (checkWin(board, 'O')) return { score: 10 - depth };
            if (checkWin(board, 'X')) return { score: depth - 10 };
            if (checkTie(board)) return { score: 0 };

            if (isMax) {
                let max = { score: -Infinity };
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        if (board[i][j] === '') {
                            board[i][j] = 'O';
                            const score = minimax(board, depth + 1, false);
                            board[i][j] = '';
                            if (score.score > max.score) max = { score: score.score, i, j };
                        }
                    }
                }
                return max;
            } else {
                let min = { score: Infinity };
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        if (board[i][j] === '') {
                            board[i][j] = 'X';
                            const score = minimax(board, depth + 1, true);
                            board[i][j] = '';
                            if (score.score < min.score) min = { score: score.score, i, j };
                        }
                    }
                }
                return min;
            }
        }

        restartButton.addEventListener('click', () => {
            location.reload();
        });

        cells.forEach((cell, index) => {
            cell.addEventListener('click', () => {
                if (changing) return;
                if (turn % 2 === 0 && cell.className === 'cell') {
                    cell.classList.add('x');
                    board[Math.floor(index / 3)][index % 3] = 'X';
                    turn++;
                }

                if (checkWin(board, 'X')) {
                    turnDisplay.textContent = 'You won!';
                    message.classList.remove('hidden');
                    winMessage.textContent = 'You won!';
                } else if (checkTie(board)) {
                    changeUntilWin();
                } else if (turn % 2 === 1) {
                    aiPlay();
                }
            });
        });

        function aiPlay() {
            turnDisplay.textContent = 'AI is thinking...';
            setTimeout(() => {
                const { i, j } = minimax(board, 0, true);
                cells[i * 3 + j].classList.remove('x');
                cells[i * 3 + j].classList.add('o');
                board[i][j] = 'O';
                turn++;
                turnDisplay.textContent = 'Your turn!';
                if (checkWin(board, 'O')) {
                    turnDisplay.textContent = 'AI won!';
                    message.classList.remove('hidden');
                    winMessage.textContent = 'AI won!';
                }
            }, 500);
        }

        function changeUntilWin() {
            changing = true;
            turnDisplay.textContent = 'Changing...';
            const changes = [];
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (board[i][j] === 'X') {
                        changes.push({ i, j });
                    }
                }
            }

            let index = 0;
            const interval = setInterval(() => {
                const { i, j } = changes[index];
                board[i][j] = 'O';
                cells[i * 3 + j].classList.remove('x');
                cells[i * 3 + j].classList.add('o', 'fromX');
                index++;
                if (checkWin(board, 'O') || index === changes.length) {
                    clearInterval(interval);
                    changing = false;
                    turnDisplay.textContent = 'AI won!';
                    message.classList.remove('hidden');
                    winMessage.textContent = 'AI won!';
                }
            }, 500);
        }
    </script>
</body>
</html>
